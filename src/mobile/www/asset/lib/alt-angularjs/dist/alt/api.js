alt.modules.api=angular.module("alt-api",[]).config(["$provide","$httpProvider",function(e,t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var n=null;e.factory("httpInterceptor",["$log","$q","$window",function(e,t,r){return{request:function(e){if(n=n||e.transformRequest,e.headers["Content-Type"])if(0===e.headers["Content-Type"].indexOf("application/x-www-form-urlencoded")){var t=[],r=function(e,t){if("$$hashKey"==e)return"";var n;switch(typeof t){case"string":case"number":return e+"="+encodeURIComponent(t);case"object":n=[];for(var a in t)t.hasOwnProperty(a)&&"$$hashKey"!=a&&n.push(r(e+"["+a+"]",t[a]));return n.join("&");case"array":n=[];for(var a=0;a<t.length;a++)n.push(r(e+"["+a+"]",t[a]));return n.join("&")}};for(var a in e.data)e.data.hasOwnProperty(a)&&"$$hashKey"!=a&&t.push(r(a,e.data[a]));e.transformRequest=n,e.data=t.join("&")}else 0==e.headers["Content-Type"].indexOf("multipart/form-data")&&(e.transformRequest=[function(t){var n=new FormData,r=function(e,t,n){if("$$hashKey"==t)return"";switch(typeof n){case"string":case"number":e.append(t,n);break;case"object":if("undefined"!=typeof File&&n instanceof File)e.append(t,n);else if("undefined"==typeof File&&"undefined"!=typeof n.name)e.append(t,n);else for(var a in n)n.hasOwnProperty(a)&&"$$hashKey"!=a&&r(e,t+"["+a+"]",n[a]);break;case"array":for(var a=0;a<n.length;a++)r(e,t+"["+a+"]",n[a])}};for(var a in e.data)e.data.hasOwnProperty(a)&&"$$hashKey"!=a&&r(n,a,e.data[a]);return n}],delete e.headers["Content-Type"]);return e},response:function(e){var n=angular.copy(e);if("object"==typeof e.data){if(n.version=e.data.v||100,n.code=e.data.s||0,n.status=n.code,n.data=e.data.d||"",n.message=e.data.m||"",n.time=e.data.t||0,n.usage=e.data.u||"",0!=n.status)return"401"==n.status?(r.location.href=alt.baseUrl+"auth/login",t.reject(n)):(n.message=n.message||"Gagal terhubung ke server",t.reject(n))}else if(0===e.config.url.indexOf(alt.serverUrl)&&"object"!=typeof e.data)return n.code=-1,n.status=n.code,n.message="Tidak dapat terhubung ke server","development"==alt.environment.toLowerCase()&&(n.message+="<br/>"+e.data),t.reject(n);return n}}}]),t.interceptors.push("httpInterceptor")}]).factory("$api",["$http","$log",function(e,t){return function(t,n){t=t||"";var r=t.split("/");return n=n||r[r.length-1]+"id",t=(0!==t.indexOf(alt.serverUrl)?alt.serverUrl:"")+t,{url:t,pkey:n,connect:function(n,r,a){return n=n||"",n=(0!==n.indexOf("/")?"/":"")+n,r=r||{},a=alt.extend({skipAuthorization:!1,ismultipart:!1},a),e({headers:{"Content-Type":a.ismultipart?"multipart/form-data":"application/x-www-form-urlencoded"},skipAuthorization:a.skipAuthorization,method:"POST",data:r,url:t+n})},count:function(e,t){return this.connect("count",e,t)},list:function(e,t){return this.connect("list",e,t)},retrieve:function(e,t,r){return e=e||"",t=t||{},t[n]=e,this.connect("retrieve",t,r)},keyvalues:function(e,t){return this.connect("keyvalues",e,t)},insert:function(e,t){return this.connect("insert",e,t)},update:function(e,t){return this.connect("update",e,t)},remove:function(e,t){e=e||"";var r={};return r[n]=e,this.connect("delete",r,t)},isexist:function(e,t){return this.connect("is_exist",e,t)}}}}]),alt.module("alt-api",alt.modules.api);